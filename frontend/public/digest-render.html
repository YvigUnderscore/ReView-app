<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1280, height=720">
  <title>Digest Render</title>
  <!-- model-viewer loaded async to not block page initialization -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 1280px;
      height: 720px;
      overflow: hidden;
      background: #1a1a1a;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    #container {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* Viewers */
    #viewer-3d,
    #viewer-video,
    #viewer-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      object-fit: contain;
    }

    #viewer-3d {
      background: transparent;
      --poster-color: transparent;
    }

    #viewer-video {
      background: #000;
    }

    #viewer-image {
      background: #1a1a1a;
    }

    /* Annotation overlay */
    #annotation-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    /* Loading indicator */
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 14px;
      z-index: 20;
    }

    /* Comment overlay - Liquid Glass Style */
    #comment-overlay {
      position: absolute;
      bottom: 24px;
      left: 24px;
      right: 24px;
      color: #fff;
      background: rgba(20, 20, 25, 0.65);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 16px 20px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 15;
      display: none;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    #comment-overlay.visible {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    #comment-overlay .avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      color: #fff;
      overflow: hidden;
      margin-right: 14px;
    }

    #comment-overlay .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #comment-overlay .content {
      flex: 1;
      min-width: 0;
    }

    #comment-overlay .user-name {
      font-weight: 600;
      font-size: 14px;
      color: #fff;
      margin-bottom: 4px;
    }

    #comment-overlay .comment-text {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container">
    <model-viewer id="viewer-3d" camera-controls interaction-prompt="none" environment-image="neutral"
      shadow-intensity="1" autoplay animation-name="" interpolation-decay="50"></model-viewer>

    <video id="viewer-video" muted playsinline></video>

    <img id="viewer-image" alt="" />

    <canvas id="annotation-canvas"></canvas>

    <div id="loading">Loading...</div>

    <div id="comment-overlay">
      <div class="avatar">
        <span class="initials"></span>
        <img class="avatar-img" style="display:none;" alt="" />
      </div>
      <div class="content">
        <div class="user-name"></div>
        <div class="comment-text"></div>
      </div>
    </div>
  </div>

  <script src="/digest-render.js"></script>
  <!-- Load model-viewer async after DigestRenderer is ready -->
  <script type="module" async
    src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
</body>

</html>